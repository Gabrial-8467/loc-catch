<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Weather & Location Tracker</title>
<style>
  body { font-family: Arial, sans-serif; background: #a18cd1; color: #fff; text-align:center; padding: 2rem; }
  #weather { margin-top: 20px; }
</style>
</head>
<body>
  <h1>Weather at Your Location</h1>
  <p id="status">Requesting location permission...</p>
  <div id="weather"></div>

  <script>
    const statusEl = document.getElementById('status');
    const weatherEl = document.getElementById('weather');

    // Your weather API details here:
    const WEATHER_API_KEY = 'YOUR_API_KEY_HERE';  // Replace with your actual key
    const WEATHER_API_URL = 'https://api.openweathermap.org/data/2.5/weather';

    // Open WebSocket to your server
    const socket = new WebSocket(`ws://${location.host}`);

    socket.onopen = () => console.log('WebSocket connected');
    socket.onerror = (err) => console.error('WebSocket error:', err);

    function sendLocation(lat, lon) {
      if (socket.readyState === WebSocket.OPEN) {
        socket.send(JSON.stringify({ type: 'location', data: { latitude: lat, longitude: lon } }));
      }
    }

    function fetchWeather(lat, lon) {
      const url = `${WEATHER_API_URL}?lat=${lat}&lon=${lon}&appid=${WEATHER_API_KEY}&units=metric`;
      fetch(url)
        .then(res => res.json())
        .then(data => {
          if (data && data.weather && data.weather.length > 0) {
            weatherEl.innerHTML = `
              <p><strong>${data.name}</strong></p>
              <p>${data.weather[0].description} 🌤️</p>
              <p>Temperature: ${data.main.temp} °C</p>
              <p>Humidity: ${data.main.humidity}%</p>
            `;
          } else {
            weatherEl.textContent = 'Could not fetch weather data.';
          }
        })
        .catch(() => {
          weatherEl.textContent = 'Error fetching weather data.';
        });
    }

    if ("geolocation" in navigator) {
      navigator.geolocation.getCurrentPosition(position => {
        const { latitude, longitude } = position.coords;
        statusEl.textContent = `Location obtained: (${latitude.toFixed(4)}, ${longitude.toFixed(4)})`;
        sendLocation(latitude, longitude);
        fetchWeather(latitude, longitude);
      }, () => {
        statusEl.textContent = 'Location permission denied.';
      });
    } else {
      statusEl.textContent = 'Geolocation not supported by your browser.';
    }
  </script>
</body>
</html>
